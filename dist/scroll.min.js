!function(){"use strict";var e=angular.module("scroll",[]);!function(e){var t=Date.now||function(){return+new Date},o=60,n=1e3,i={},l=1;e.core?core.effect||(core.effect={}):e.core={effect:{}},core.effect.Animate={requestAnimationFrame:function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,o=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(o=!1),o)return function(e,o){t(e,o)};var n=60,i={},l=0,r=1,a=null,c=+new Date;return function(e,t){var o=r++;return i[o]=e,l++,null===a&&(a=setInterval(function(){var e=+new Date,t=i;i={},l=0;for(var o in t)t.hasOwnProperty(o)&&(t[o](e),c=e);e-c>2500&&(clearInterval(a),a=null)},1e3/n)),o}}(),stop:function(e){var t=null!=i[e];return t&&(i[e]=null),t},isRunning:function(e){return null!=i[e]},start:function(e,r,a,c,_,s){var f=t(),h=f,u=0,p=0,m=l++;if(s||(s=document.body),m%20===0){var g={};for(var v in i)g[v]=!0;i=g}var d=function(l){var g=l!==!0,v=t();if(!i[m]||r&&!r(m))return i[m]=null,void(a&&a(o-p/((v-f)/n),m,!1));if(g)for(var T=Math.round((v-h)/(n/o))-1,S=0;S<Math.min(T,4);S++)d(!0),p++;c&&(u=(v-f)/c,u>1&&(u=1));var L=_?_(u):u;e(L,v,g)!==!1&&1!==u||!g?g&&(h=v,core.effect.Animate.requestAnimationFrame(d,s)):(i[m]=null,a&&a(o-p/((v-f)/n),m,1===u||null==c))};return i[m]=!0,core.effect.Animate.requestAnimationFrame(d,s),m}}}(window);var t;!function(){t=function(e,t){this.__callback=e,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3};for(var o in t)this.options[o]=t[o]};var e=function(e){return Math.pow(e-1,3)+1},o=function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},n={__isSingleTouch:!1,__isTracking:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(e,t,o,n){var i=this;e&&(i.__clientWidth=e),t&&(i.__clientHeight=t),o&&(i.__contentWidth=o),n&&(i.__contentHeight=n),i.__computeScrollMax(),i.scrollTo(i.__scrollLeft,i.__scrollTop,!0)},setPosition:function(e,t){var o=this;o.__clientLeft=e||0,o.__clientTop=t||0},setSnapSize:function(e,t){var o=this;o.__snapWidth=e,o.__snapHeight=t},activatePullToRefresh:function(e,t,o,n){var i=this;i.__refreshHeight=e,i.__refreshActivate=t,i.__refreshDeactivate=o,i.__refreshStart=n},finishPullToRefresh:function(){var e=this;e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0)},getValues:function(){var e=this;return{left:e.__scrollLeft,top:e.__scrollTop,zoom:e.__zoomLevel}},getScrollMax:function(){var e=this;return{left:e.__maxScrollLeft,top:e.__maxScrollTop}},zoomTo:function(e,t,o,n){var i=this;if(!i.options.zooming)throw new Error("Zooming is not enabled!");i.__isDecelerating&&(core.effect.Animate.stop(i.__isDecelerating),i.__isDecelerating=!1);var l=i.__zoomLevel;null==o&&(o=i.__clientWidth/2),null==n&&(n=i.__clientHeight/2),e=Math.max(Math.min(e,i.options.maxZoom),i.options.minZoom),i.__computeScrollMax(e);var r=(o+i.__scrollLeft)*e/l-o,a=(n+i.__scrollTop)*e/l-n;r>i.__maxScrollLeft?r=i.__maxScrollLeft:0>r&&(r=0),a>i.__maxScrollTop?a=i.__maxScrollTop:0>a&&(a=0),i.__publish(r,a,e,t)},zoomBy:function(e,t,o,n){var i=this;i.zoomTo(i.__zoomLevel*e,t,o,n)},scrollTo:function(e,t,o,n){var i=this;if(i.__isDecelerating&&(core.effect.Animate.stop(i.__isDecelerating),i.__isDecelerating=!1),null!=n&&n!==i.__zoomLevel){if(!i.options.zooming)throw new Error("Zooming is not enabled!");e*=n,t*=n,i.__computeScrollMax(n)}else n=i.__zoomLevel;i.options.scrollingX?i.options.paging?e=Math.round(e/i.__clientWidth)*i.__clientWidth:i.options.snapping&&(e=Math.round(e/i.__snapWidth)*i.__snapWidth):e=i.__scrollLeft,i.options.scrollingY?i.options.paging?t=Math.round(t/i.__clientHeight)*i.__clientHeight:i.options.snapping&&(t=Math.round(t/i.__snapHeight)*i.__snapHeight):t=i.__scrollTop,e=Math.max(Math.min(i.__maxScrollLeft,e),0),t=Math.max(Math.min(i.__maxScrollTop,t),0),e===i.__scrollLeft&&t===i.__scrollTop&&(o=!1),i.__publish(e,t,n,o)},scrollBy:function(e,t,o){var n=this,i=n.__isAnimating?n.__scheduledLeft:n.__scrollLeft,l=n.__isAnimating?n.__scheduledTop:n.__scrollTop;n.scrollTo(i+(e||0),l+(t||0),o)},doMouseZoom:function(e,t,o,n){var i=this,l=e>0?.97:1.03;return i.zoomTo(i.__zoomLevel*l,!1,o-i.__clientLeft,n-i.__clientTop)},doTouchStart:function(e,t){if(null==e.length)throw new Error("Invalid touch list: "+e);if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var o=this;o.__isDecelerating&&(core.effect.Animate.stop(o.__isDecelerating),o.__isDecelerating=!1),o.__isAnimating&&(core.effect.Animate.stop(o.__isAnimating),o.__isAnimating=!1);var n,i,l=1===e.length;l?(n=e[0].pageX,i=e[0].pageY):(n=Math.abs(e[0].pageX+e[1].pageX)/2,i=Math.abs(e[0].pageY+e[1].pageY)/2),o.__initialTouchLeft=n,o.__initialTouchTop=i,o.__zoomLevelStart=o.__zoomLevel,o.__lastTouchLeft=n,o.__lastTouchTop=i,o.__lastTouchMove=t,o.__lastScale=1,o.__enableScrollX=!l&&o.options.scrollingX,o.__enableScrollY=!l&&o.options.scrollingY,o.__isTracking=!0,o.__isDragging=!l,o.__isSingleTouch=l,o.__positions=[]},doTouchMove:function(e,t,o){if(null==e.length)throw new Error("Invalid touch list: "+e);if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);var n=this;if(n.__isTracking){var i,l;2===e.length?(i=Math.abs(e[0].pageX+e[1].pageX)/2,l=Math.abs(e[0].pageY+e[1].pageY)/2):(i=e[0].pageX,l=e[0].pageY);var r=n.__positions;if(n.__isDragging){var a=i-n.__lastTouchLeft,c=l-n.__lastTouchTop,_=n.__scrollLeft,s=n.__scrollTop,f=n.__zoomLevel;if(null!=o&&n.options.zooming){var h=f;if(f=f/n.__lastScale*o,f=Math.max(Math.min(f,n.options.maxZoom),n.options.minZoom),h!==f){var u=i-n.__clientLeft,p=l-n.__clientTop;_=(u+_)*f/h-u,s=(p+s)*f/h-p,n.__computeScrollMax(f)}}if(n.__enableScrollX){_-=a;var m=n.__maxScrollLeft;(_>m||0>_)&&(n.options.bouncing?_+=a/2:_=_>m?m:0)}if(n.__enableScrollY){s-=c;var g=n.__maxScrollTop;(s>g||0>s)&&(n.options.bouncing?(s+=c/2,n.__enableScrollX||null==n.__refreshHeight||(!n.__refreshActive&&s<=-n.__refreshHeight?(n.__refreshActive=!0,n.__refreshActivate&&n.__refreshActivate()):n.__refreshActive&&s>-n.__refreshHeight&&(n.__refreshActive=!1,n.__refreshDeactivate&&n.__refreshDeactivate()))):s=s>g?g:0)}r.length>60&&r.splice(0,30),r.push(_,s,t),n.__publish(_,s,f)}else{var v=n.options.locking?3:0,d=5,T=Math.abs(i-n.__initialTouchLeft),S=Math.abs(l-n.__initialTouchTop);n.__enableScrollX=n.options.scrollingX&&T>=v,n.__enableScrollY=n.options.scrollingY&&S>=v,r.push(n.__scrollLeft,n.__scrollTop,t),n.__isDragging=(n.__enableScrollX||n.__enableScrollY)&&(T>=d||S>=d)}n.__lastTouchLeft=i,n.__lastTouchTop=l,n.__lastTouchMove=t,n.__lastScale=o}},doTouchEnd:function(e){if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);var t=this;if(t.__isTracking){if(t.__isTracking=!1,t.__isDragging&&(t.__isDragging=!1,t.__isSingleTouch&&t.options.animating&&e-t.__lastTouchMove<=100)){for(var o=t.__positions,n=o.length-1,i=n,l=n;l>0&&o[l]>t.__lastTouchMove-100;l-=3)i=l;if(i!==n){var r=o[n]-o[i],a=t.__scrollLeft-o[i-2],c=t.__scrollTop-o[i-1];t.__decelerationVelocityX=a/r*(1e3/60),t.__decelerationVelocityY=c/r*(1e3/60);var _=t.options.paging||t.options.snapping?4:1;(Math.abs(t.__decelerationVelocityX)>_||Math.abs(t.__decelerationVelocityY)>_)&&(t.__refreshActive||t.__startDeceleration(e))}}t.__isDecelerating||(t.__refreshActive&&t.__refreshStart?(t.__publish(t.__scrollLeft,-t.__refreshHeight,t.__zoomLevel,!0),t.__refreshStart&&t.__refreshStart()):(t.scrollTo(t.__scrollLeft,t.__scrollTop,!0,t.__zoomLevel),t.__refreshActive&&(t.__refreshActive=!1,t.__refreshDeactivate&&t.__refreshDeactivate()))),t.__positions.length=0}},__publish:function(t,n,i,l){var r=this,a=r.__isAnimating;if(a&&(core.effect.Animate.stop(a),r.__isAnimating=!1),l&&r.options.animating){r.__scheduledLeft=t,r.__scheduledTop=n,r.__scheduledZoom=i;var c=r.__scrollLeft,_=r.__scrollTop,s=r.__zoomLevel,f=t-c,h=n-_,u=i-s,p=function(e,t,o){o&&(r.__scrollLeft=c+f*e,r.__scrollTop=_+h*e,r.__zoomLevel=s+u*e,r.__callback&&r.__callback(r.__scrollLeft,r.__scrollTop,r.__zoomLevel))},m=function(e){return r.__isAnimating===e},g=function(e,t,o){t===r.__isAnimating&&(r.__isAnimating=!1),r.options.zooming&&r.__computeScrollMax()};r.__isAnimating=core.effect.Animate.start(p,m,g,r.options.animationDuration,a?e:o)}else r.__scheduledLeft=r.__scrollLeft=t,r.__scheduledTop=r.__scrollTop=n,r.__scheduledZoom=r.__zoomLevel=i,r.__callback&&r.__callback(t,n,i),r.options.zooming&&r.__computeScrollMax()},__computeScrollMax:function(e){var t=this;null==e&&(e=t.__zoomLevel),t.__maxScrollLeft=Math.max(t.__contentWidth*e-t.__clientWidth,0),t.__maxScrollTop=Math.max(t.__contentHeight*e-t.__clientHeight,0)},__startDeceleration:function(e){var t=this;if(t.options.paging){var o=Math.max(Math.min(t.__scrollLeft,t.__maxScrollLeft),0),n=Math.max(Math.min(t.__scrollTop,t.__maxScrollTop),0),i=t.__clientWidth,l=t.__clientHeight;t.__minDecelerationScrollLeft=Math.floor(o/i)*i,t.__minDecelerationScrollTop=Math.floor(n/l)*l,t.__maxDecelerationScrollLeft=Math.ceil(o/i)*i,t.__maxDecelerationScrollTop=Math.ceil(n/l)*l}else t.__minDecelerationScrollLeft=0,t.__minDecelerationScrollTop=0,t.__maxDecelerationScrollLeft=t.__maxScrollLeft,t.__maxDecelerationScrollTop=t.__maxScrollTop;var r=function(e,o,n){t.__stepThroughDeceleration(n)},a=t.options.snapping?4:.1,c=function(){return Math.abs(t.__decelerationVelocityX)>=a||Math.abs(t.__decelerationVelocityY)>=a},_=function(e,o,n){t.__isDecelerating=!1,t.scrollTo(t.__scrollLeft,t.__scrollTop,t.options.snapping)};t.__isDecelerating=core.effect.Animate.start(r,c,_)},__stepThroughDeceleration:function(e){var t=this,o=t.__scrollLeft+t.__decelerationVelocityX,n=t.__scrollTop+t.__decelerationVelocityY;if(!t.options.bouncing){var i=Math.max(Math.min(t.__maxDecelerationScrollLeft,o),t.__minDecelerationScrollLeft);i!==o&&(o=i,t.__decelerationVelocityX=0);var l=Math.max(Math.min(t.__maxDecelerationScrollTop,n),t.__minDecelerationScrollTop);l!==n&&(n=l,t.__decelerationVelocityY=0)}if(e?t.__publish(o,n,t.__zoomLevel):(t.__scrollLeft=o,t.__scrollTop=n),!t.options.paging){var r=.95;t.__decelerationVelocityX*=r,t.__decelerationVelocityY*=r}if(t.options.bouncing){var a=0,c=0,_=.03,s=.08;o<t.__minDecelerationScrollLeft?a=t.__minDecelerationScrollLeft-o:o>t.__maxDecelerationScrollLeft&&(a=t.__maxDecelerationScrollLeft-o),n<t.__minDecelerationScrollTop?c=t.__minDecelerationScrollTop-n:n>t.__maxDecelerationScrollTop&&(c=t.__maxDecelerationScrollTop-n),0!==a&&(a*t.__decelerationVelocityX<=0?t.__decelerationVelocityX+=a*_:t.__decelerationVelocityX=a*s),0!==c&&(c*t.__decelerationVelocityY<=0?t.__decelerationVelocityY+=c*_:t.__decelerationVelocityY=c*s)}}};for(var i in n)t.prototype[i]=n[i]}();var o=function(e,n){this.content=e,this.container=e.parentNode,this.options=n||{};var i=this;this.scroller=new t(function(e,t,o){i.options.onScroll({left:e,top:t,zoom:o}),i.render(e,t,o)},n),this.bindEvents(),this.content.style[o.vendorPrefix+"TransformOrigin"]="left top",this.reflow()};o.prototype.render=function(){var e,t=document.documentElement.style;window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?e="presto":"MozAppearance"in t?e="gecko":"WebkitAppearance"in t?e="webkit":"string"==typeof navigator.cpuClass&&(e="trident");var n,i=o.vendorPrefix={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[e],l=document.createElement("div"),r=i+"Perspective",a=i+"Transform";return l.style[r]!==n?function(e,t,o){this.content.style[a]="translate3d("+-e+"px,"+-t+"px,0) scale("+o+")"}:l.style[a]!==n?function(e,t,o){this.content.style[a]="translate("+-e+"px,"+-t+"px) scale("+o+")"}:function(e,t,o){this.content.style.marginLeft=e?-e/o+"px":"",this.content.style.marginTop=t?-t/o+"px":"",this.content.style.zoom=o||""}}(),o.prototype.reflow=function(){this.scroller.setDimensions(this.container.clientWidth,this.container.clientHeight,this.content.offsetWidth,this.content.offsetHeight);var e=this.container.getBoundingClientRect();this.scroller.setPosition(e.left+this.container.clientLeft,e.top+this.container.clientTop)},o.prototype.bindEvents=function(){var e=this,t=n.throttle(function(){e.reflow()},300);if(window.addEventListener("resize",t,!1),window.addEventListener("DOMNodeInserted",t,!1),window.addEventListener("DOMNodeRemoved",t,!1),"ontouchstart"in window)this.container.addEventListener("touchstart",function(t){t.touches[0]&&t.touches[0].target&&t.touches[0].target.tagName.match(/input|textarea|select/i)||e.scroller.doTouchStart(t.touches,t.timeStamp)},!1),document.addEventListener("touchmove",function(t){e.scroller.doTouchMove(t.touches,t.timeStamp,t.scale)},!1),document.addEventListener("touchend",function(t){e.scroller.doTouchEnd(t.timeStamp)},!1),document.addEventListener("touchcancel",function(t){e.scroller.doTouchEnd(t.timeStamp)},!1);else{var o=!1;this.container.addEventListener("mousedown",function(t){t.target.tagName.match(/input|textarea|select/i)||(e.scroller.doTouchStart([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),o=!0,t.preventDefault())},!1),document.addEventListener("mousemove",function(t){o&&(e.scroller.doTouchMove([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),o=!0)},!1),document.addEventListener("mouseup",function(t){o&&(e.scroller.doTouchEnd(t.timeStamp),o=!1)},!1),this.container.addEventListener("mousewheel",function(t){e.options.zooming&&(e.scroller.doMouseZoom(t.wheelDelta,t.timeStamp,t.pageX,t.pageY),t.preventDefault())},!1)}},e.controller("$scroll",function(e){this.scroll=null,this._finishRefresh=function(){this.scroll.refresher.className=this.scroll.refresher.className.replace(" "+this.scroll.refreshConfig.runningClass,""),this.scroll.scroller.finishPullToRefresh()},this.setRefresher=function(t,o,n){t=angular.element(t),t=t[0],this.scroll.refresher=t,n=n||{activeClass:"active",runningClass:"running"},this.scroll.refreshConfig=n,this.scroll&&this.scroll.scroller.activatePullToRefresh(t.offsetHeight,function(){t.className+=" "+n.activeClass,t.innerHTML=o.pullText},function(){t.className=t.className.replace(" "+n.activeClass,""),t.innerHTML=o.releaseText},function(){t.className+=" "+n.runningClass,t.innerHTML=o.refreshText,e.onRefresh&&e.onRefresh()()})},this.setScroll=function(e,t){var i=t.scrollable||"y",l=t.zoomable||"",r=l.split("-"),a=r.length>1&&parseFloat(r[0]),c=r.length>1&&parseFloat(r[1]),_=300;this.$element=angular.element(e);var s=this,f=n.throttle(function(e){s.$element.triggerHandler("scroll",e)},_);this.scroll=new o(e,{scrollingX:"true"===i||"x"===i,scrollingY:"true"===i||"y"===i,zooming:"true"===l||r.length>1,minZoom:a,maxZoom:c,onScroll:f})}}),e.directive("infinityScroll",function(e){return{restrict:"E",require:["^scroll","infinityScroll"],replace:!0,template:'<div class="infinity-scroll">loading</div>',scope:{onInfinite:"&"},controller:function(e){var t=!1;this.infinityScroll=function(){t||(console.log("infinityScroll",e.onInfinite()),e.onInfinite()&&(e.onInfinite()(),t=!0))},this.finishInfinityScroll=function(){t=!1}},link:function(t,o,n,i){console.log(i);var l=i[0],r=i[1],a={start:50};e.debug("infinity scroll",l),l.$element.bind("scroll",function(t,o){var n=l.scroll.scroller.__contentHeight-l.scroll.scroller.__clientHeight-o.top;e.debug("infinity scroll",n,a.start),n<a.start&&r.infinityScroll()}),t.$on("$scrollDidFinishInfinity",function(){e.debug("scrollDidFinishInfinity"),r.finishInfinityScroll()}),t.$on("$destroy",function(){e.debug("infinity scroll destroy"),l.$element.off("scroll")})}}}),e.directive("refresher",function(e){return{restrict:"E",require:["^scroll"],replace:!1,template:'<div class="refresh"></div>',scope:{pullText:"=",releaseText:"=",refreshText:"="},link:function(t,o,n,i){var l=i[0];t.pullText=t.pullText||"Pull to refresh...",t.releaseText=t.releaseText||"Release to refresh...",t.refreshText=t.refreshText||"Loading...",e.debug("refresher directive:: scroll ctrl",i,l.scroll),l.setRefresher(angular.element(o[0].querySelector(".refresh")),t),t.$on("$scrollDidFinishLoading",function(){l._finishRefresh()})}}}),e.directive("scroll",function(e,t){return{restrict:"EA",scope:{onRefresh:"&"},controller:"$scroll",compile:function(e,t){function o(e,t,o,i){i.setScroll(n[0],{scrollable:o.scrollable,zommable:o.zoomable})}e.addClass("scroll");var n=angular.element("<div/>").addClass("scroll-wrap");return n.append(e.contents()),e.append(n),{pre:o}}}});var n={throttle:function(e,t,o){var n,i,l,r=null,a=0;o||(o={});var c=function(){a=o.leading===!1?0:Date.now(),r=null,l=e.apply(n,i)};return function(){var _=Date.now();a||o.leading!==!1||(a=_);var s=t-(_-a);return n=this,i=arguments,0>=s?(clearTimeout(r),r=null,a=_,l=e.apply(n,i)):r||o.trailing===!1||(r=setTimeout(c,s)),l}}}}();